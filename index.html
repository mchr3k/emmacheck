---
layout: default
title: EmmaCheck - Home
---
<h2>Home</h2>

<p>EmmaCheck is an ant task which enforces particular Java code coverage levels.

<p>Download <a href="http://github.com/mchr3k/emmacheck/raw/master/binaries/emmacheck-0.2.jar">emmacheck-0.2.jar</a>

<h3>The Problem</h3>

<p><a href="http://emma.sourceforge.net/">EMMA</a> is the Java code coverage engine used by the popular 
<a href="http://www.eclemma.org/">EclEmma</a> Eclipse plugin. With a few extra lines in 
your <a href="http://ant.apache.org/">ANT</a> build.xml file you can generate a code coverage report for your Java project.

<p>But what then? Will you ever look at the coverage report in the future?

<h3>The Solution</h3>

<p>Measuring code coverage is most useful if you can actually enforce a particular level of 
coverage. EmmaCheck automates the checking of an EMMA code coverage report.

<p>There are two common use cases.

<h4>Overall Code Coverage</h4>

<p>First you need to download emmacheck-0.2.jar and place it within your java project. Second, you need to add the following 
lines near the top of your build.xml file to tell ANT about the emmacheck task.

<pre class="prettyprint lang-xml">
&lt;taskdef name="emmacheck" classname="org.emmacheck.EmmaCheckTask"
                          classpath="./lib/ant/emmacheck-0.2.jar"/&gt;</pre>

<p>The following lines of XML will check that 100% of lines were covered.

<pre class="prettyprint lang-xml">
&lt;emmacheck coveragefile="reports/coverage/coverage.emma"
		   metadatafile="reports/coverage/metadata.emma"
		   outputfile="reports/coverage/requiredcoverage.out"
		   overallcoverage="L100" /&gt;</pre>

<p>The overallcoverage parameter accepts 4 formats.

<ul>
<li>100 - 100% of lines were covered
<li>L100 - 100% of lines were covered
<li>M100 - 100% of methods were covered
<li>B100 - 100% of basic blocks were covered
</ul>

<h4>Source Level Code Coverage</h4>

<p>Getting 100% overall code coverage can be really difficult. However, it 
is much easier to get 100% coverage of particular files and this can also be enforced by emmacheck.

<p>The following lines of XML will check that the coverage set out in requiredcoverage.properties is met.

<pre class="prettyprint lang-xml">
&lt;emmacheck coveragefile="reports/coverage/coverage.emma"
		   metadatafile="reports/coverage/metadata.emma"
		   outputfile="reports/coverage/requiredcoverage.out"
		   requiredcoverage="config/requiredcoverage.properties" /&gt;</pre>

<p>requiredcoverage.properties should look something like this.

<pre>
org.example.Source.java               = L100
org.example.subpackage.SubSource.java = B95</pre>

<h3>Complete Example</h3>

<p>This section includes a complete example build.xml file showing how to do all of the following.

<ul>
<li>Compile your code
<li>Instrument the compiled code
<li>Compile your tests
<li>Run your tests against the instrumented code
<li>Generate an EMMA report
<li>Run the EmmaCheck task to check the level of code coverage
</ul>
	
<p>Here is the ANT build.xml file.

<pre class="prettyprint lang-xml">
&lt;project name="Example" basedir="." default="help"&gt;

  &lt;path id="emma.lib" &gt;
	&lt;pathelement location="./lib/ant/emma.jar" /&gt;
	&lt;pathelement location="./lib/ant/emma_ant.jar" /&gt;
  &lt;/path&gt;
  &lt;path id="project.classpath" &gt;
	&lt;fileset dir="./lib" includes="*.jar" /&gt;
  &lt;/path&gt;

  &lt;taskdef resource="emma_ant.properties" classpathref="emma.lib" /&gt;
  &lt;taskdef name="emmacheck" classname="org.emmacheck.EmmaCheckTask"
		   classpath="./lib/ant/emmacheck-0.2.jar"/&gt;

  &lt;target name="help"&gt;
	&lt;java classname="org.apache.tools.ant.Main"&gt;
	  &lt;arg value="-projecthelp" /&gt;
	&lt;/java&gt;
  &lt;/target&gt;

  &lt;target name="clean" description="Clean built files"&gt;
	&lt;delete dir="./build" /&gt;
	&lt;delete dir="./reports" /&gt;
  &lt;/target&gt;

  &lt;target name="build" description="Build classes"&gt;

	&lt;mkdir dir="./build" /&gt;
	&lt;mkdir dir="./build/classes" /&gt;

	&lt;!-- Compile project source code --&gt;
	&lt;javac classpathref="project.classpath"
		   destdir="./build/classes"
		   debug="true"
		   source="1.6"
		   target="1.6"
		   includeAntRuntime="false"&gt;
	  &lt;src path="./src" /&gt;
	&lt;/javac&gt;

  &lt;/target&gt;

  &lt;target name="test" description="Run UTs and generate code coverage report" depends="build"&gt;
	&lt;property name="emma.enabled" value="true" /&gt;

	&lt;mkdir dir="./reports" /&gt;
	&lt;mkdir dir="./reports/test" /&gt;
	&lt;mkdir dir="./reports/test/raw" /&gt;
	&lt;mkdir dir="./reports/coverage" /&gt;
	&lt;mkdir dir="./reports/coverage/metadata" /&gt;

	&lt;mkdir dir="./build/test" /&gt;
	&lt;mkdir dir="./build/classes_instr" /&gt;

	&lt;!-- Compile test source code --&gt;
	&lt;javac destdir="./build/test" debug="true" source="1.6" target="1.6" includeAntRuntime="false"&gt;
	  &lt;src path="./testsrc"/&gt;
	  &lt;classpath&gt;
		&lt;pathelement path="./build/classes" /&gt;
		&lt;path refid="project.classpath" /&gt;
		&lt;path refid="test.classpath" /&gt;
	  &lt;/classpath&gt;
	&lt;/javac&gt;

	&lt;!-- Copy base class files --&gt;
	&lt;copy todir="./build/classes_instr"&gt;
	  &lt;fileset dir="./build/classes" /&gt;
	&lt;/copy&gt;

	&lt;!-- Instrument class files --&gt;
	&lt;emma enabled="${emma.enabled}" &gt;
	  &lt;instr instrpath="./build/classes_instr"
			 metadatafile="./reports/coverage/metadata/metadata.emma"
			 merge="true"
			 mode="overwrite"
	  /&gt;
	&lt;/emma&gt;

	&lt;!-- Run tests using the instrumented class files --&gt;
	&lt;junit printsummary="yes" haltonfailure="yes"&gt;
	  &lt;classpath&gt;
		&lt;pathelement location="./build/classes_instr"/&gt;
		&lt;pathelement location="./build/test"/&gt;
		&lt;path refid="emma.lib" /&gt;
		&lt;path refid="project.classpath" /&gt;
	  &lt;/classpath&gt;
	  &lt;jvmarg value="-Demma.coverage.out.file=./reports/coverage/metadata/coverage.emma" /&gt;
	  &lt;jvmarg value="-Demma.coverage.out.merge=true" /&gt;

	  &lt;formatter type="xml"/&gt;
	  &lt;formatter type="plain"/&gt;

	  &lt;batchtest fork="yes" todir="./reports/test/raw"&gt;
	  &lt;fileset dir="./testsrc"&gt;
		&lt;include name="**/*TestCase.java"/&gt;
	  &lt;/fileset&gt;
	  &lt;/batchtest&gt;
	&lt;/junit&gt;

	&lt;!-- Generate a JUnit report --&gt;
	&lt;junitreport todir="./reports/test"&gt;
	  &lt;fileset dir="./reports/test/raw"&gt;
		&lt;include name="TEST-*.xml"/&gt;
	  &lt;/fileset&gt;
	  &lt;report format="frames" todir="./reports/test/"/&gt;
	&lt;/junitreport&gt;

	&lt;!-- Generate EMMA reports --&gt;
	&lt;emma enabled="${emma.enabled}" &gt;
	  &lt;report sourcepath="./src" &gt;
		&lt;fileset dir="./reports/coverage/metadata/" &gt;
		  &lt;include name="*.emma" /&gt;
		&lt;/fileset&gt;

		&lt;txt outfile="./reports/coverage/coverage.txt" /&gt;
		&lt;html outfile="./reports/coverage/coverage.html" depth="class"/&gt;
	  &lt;/report&gt;
	&lt;/emma&gt;

	&lt;!-- Check the EMMA code coverage against requiredcoverage.properties --&gt;
	&lt;emmacheck coveragefile="./reports/coverage/metadata/coverage.emma"
			   metadatafile="./reports/coverage/metadata/metadata.emma"
			   requiredcoverage="./config/requiredcoverage.properties"
			   output="./reports/coverage/requiredcoverage.out" /&gt;
  &lt;/target&gt;  

&lt;/project&gt;</pre>



